<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:int-jms="http://www.springframework.org/schema/integration/jms"
             xmlns:int="http://www.springframework.org/schema/integration"
             xmlns:int-xml="http://www.springframework.org/schema/integration/xml"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
                  http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.springframework.org/schema/integration
                  http://www.springframework.org/schema/integration/spring-integration.xsd
                  http://www.springframework.org/schema/integration/jms
                  http://www.springframework.org/schema/integration/jms/spring-integration-jms.xsd
                  http://www.springframework.org/schema/integration/xml
                  http://www.springframework.org/schema/integration/xml/spring-integration-xml-1.0.xsd
                  ">
    <channel id="inputChannel"/>
    <channel id="businessChannel">
        <dispatcher/>
    </channel>
    <channel id="outputChannel"/>

    <int-jms:message-driven-channel-adapter id="jmsInAdapter"
                                            connection-factory="connectionFactory"
                                            destination="queueIn"
                                            channel="inputChannel"/>


    <service-activator input-channel="inputChannel"
                       output-channel="businessChannel"
                       ref="storageService"
                       method="storeInDB"/>


    <chain input-channel="businessChannel" output-channel="outputChannel">
        <transformer ref="businessService" method="doSomething"/>
        <int-xml:marshalling-transformer marshaller="xmlMarshaller" result-type="StringResult" />
        <transformer expression="payload.toString()"/>
    </chain>

    <int-jms:outbound-channel-adapter id="jmsOut" destination="queueOut" channel="outputChannel"/>

</beans:beans>
